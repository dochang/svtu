version: 2.1

orbs:
  megalinter: relativesure/megalinter@2.0.0
  go: circleci/go@2.2.4
  codecov: codecov/codecov@5.2.0

jobs:
  test:
    parameters:
      go-version:
        type: string
    executor:
      name: go/default
      tag: << parameters.go-version >>
    steps:
      - checkout
      - go/with-cache:
          steps:
            - go/mod-download
            - go/test:
                coverprofile: coverage.txt
                covermode: atomic
      - codecov/upload:
          files: coverage.txt

workflows:
  CI:
    jobs:
      - megalinter/run:
          flavor: go
          tag: v8
          context: grafana_cloud_free_tier
      - test:
          matrix:
            parameters:
              go-version:
                - "1.22"
                - "1.23"
